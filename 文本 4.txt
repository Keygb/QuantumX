let body = $response.body;
let obj = JSON.parse(body);

// 1. 删除 homeTopList 里 name = "fish_home_widget_banner_single" 的项
if (Array.isArray(obj.data?.homeTopList)) {
    obj.data.homeTopList = obj.data.homeTopList.filter(item => item?.template?.name !== "fish_home_widget_banner_single");
}

// 2. 删除 sections 里 cardType = "homeMultiBanner" 或 "mamaAD" 的项
if (Array.isArray(obj.data?.sections)) {
    obj.data.sections = obj.data.sections.filter(item => {
        const cardType = item?.data?.clickParam?.args?.cardType;
        return cardType !== "homeMultiBanner" && cardType !== "mamaAD" && cardType !== "banner" && cardType !== "mamaAD";
    });
}

// 3. 删除 template.cardEnum = "ads" 的 sections
if (Array.isArray(obj.data?.sections)) {
    obj.data.sections = obj.data.sections.filter(item => item?.template?.cardEnum !== "ads");
}

// 4. walk components 删除 fish_city_banner 下的 data.item
function walk(node) {
    if (typeof node === "object" && node !== null) {
        if (Array.isArray(node.components)) {
            node.components = node.components.map(component => {
                if (component?.data?.template?.name === "fish_city_banner") {
                    if (component.data?.item) delete component.data.item;
                }
                return component;
            });
        }
        for (const key in node) {
            walk(node[key]);
        }
    }
}
walk(obj);

// 5. 删除 container.sections 里有 item.tips 的项 & 删除有 item.bottom 的项
if (Array.isArray(obj.data?.container?.sections)) {
    obj.data.container.sections = obj.data.container.sections.filter(item => !item?.item?.tips);
    obj.data.container.sections = obj.data.container.sections.filter(item => !item?.item?.bottom);
}

// 6. 清空 circleList[].showInfo.titleImage 的 lightUrl / url 并删除 width, height
if (Array.isArray(obj.data?.circleList)) {
    obj.data.circleList.forEach(circle => {
        const titleImage = circle?.showInfo?.titleImage;
        if (titleImage) {
            titleImage.lightUrl = "";
            titleImage.url = "";
            delete titleImage.width;
            delete titleImage.height;
        }
    });
}

// 7. 删除 resultList 中 bizType = "ad" 的项
if (Array.isArray(obj.data?.resultList)) {
    obj.data.resultList = obj.data.resultList.filter(item => {
        return item?.data?.item?.main?.exContent?.dislikeFeedback?.clickParam?.args?.bizType !== "ad";
    });
}

// 8. 删除 cardList 中 cardData 含 hotwords 的字段
if (Array.isArray(obj.data?.cardList)) {
    obj.data.cardList = obj.data.cardList.map(card => {
        if (card?.cardData?.hotwords) {
            delete card.cardData.hotwords;
        }
        return card;
    });
}

$done({ body: JSON.stringify(obj) });